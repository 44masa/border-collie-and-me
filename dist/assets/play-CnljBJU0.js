var H=Object.defineProperty;var U=(c,e,i)=>e in c?H(c,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[e]=i;var n=(c,e,i)=>U(c,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))t(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const O=""+new URL("top-C-OvFpRS.png",import.meta.url).href,W=""+new URL("down-C-Dr9rgb.png",import.meta.url).href,X=""+new URL("left-dIWqae8_.png",import.meta.url).href,A=""+new URL("right-Xg6fDZVo.png",import.meta.url).href,Y=""+new URL("up-BAWdFxAc.png",import.meta.url).href,q=""+new URL("down-N1_pqM9R.png",import.meta.url).href,P=""+new URL("left-B7Kh5tMp.png",import.meta.url).href,N=""+new URL("right-C5XEbeL-.png",import.meta.url).href;class z{constructor(e){n(this,"canvas");n(this,"ctx");n(this,"config");n(this,"state");n(this,"assets");n(this,"timer",null);n(this,"lastTime",0);n(this,"sheepCountElement");n(this,"targetCountElement");n(this,"timeElement");n(this,"levelElement");n(this,"levelCompleteMessage");n(this,"timeoutMessage");n(this,"gameClearMessage");n(this,"nextLevelButton");n(this,"restartButton");n(this,"timeoutRestartButton");this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.config={sheepCount:1,targetSheepCount:1,dogSpeed:3,sheepSpeed:1.5,dogInfluenceRadius:100,gateWidth:100,gateHeight:60,timeLimit:60,level:1,maxLevel:10,mapWidth:400,mapHeight:300},this.canvas.width=this.config.mapWidth,this.canvas.height=this.config.mapHeight,this.state={dog:{x:this.config.mapWidth/2,y:this.config.mapHeight/2,width:60,height:60,direction:"down",speed:this.config.dogSpeed},sheep:[],gate:{x:this.config.mapWidth-100,y:this.config.mapHeight/2-this.config.gateHeight/2,width:this.config.gateWidth,height:this.config.gateHeight},wall:{x:this.config.mapWidth-100-5,y:this.config.mapHeight/2-this.config.gateHeight/2,width:5,height:this.config.gateHeight},keys:{ArrowUp:!1,ArrowDown:!1,ArrowLeft:!1,ArrowRight:!1},sheepInGate:0,levelComplete:!1,gameOver:!1,gameClear:!1,timeRemaining:this.config.timeLimit},this.assets={dogUp:new Image,dogDown:new Image,dogLeft:new Image,dogRight:new Image,sheepUp:new Image,sheepDown:new Image,sheepLeft:new Image,sheepRight:new Image},this.assets.dogUp.src=O,this.assets.dogDown.src=W,this.assets.dogLeft.src=X,this.assets.dogRight.src=A,this.assets.sheepUp.src=Y,this.assets.sheepDown.src=q,this.assets.sheepLeft.src=P,this.assets.sheepRight.src=N,this.sheepCountElement=document.getElementById("sheepCount"),this.targetCountElement=document.getElementById("targetCount"),this.timeElement=document.getElementById("timeRemaining"),this.levelElement=document.getElementById("currentLevel"),this.levelCompleteMessage=document.getElementById("levelCompleteMessage"),this.timeoutMessage=document.getElementById("timeoutMessage"),this.gameClearMessage=document.getElementById("gameClearMessage"),this.nextLevelButton=document.getElementById("nextLevelButton"),this.restartButton=document.getElementById("restartButton"),this.timeoutRestartButton=document.getElementById("timeoutRestartButton"),this.targetCountElement.textContent=this.config.targetSheepCount.toString(),this.levelElement.textContent=this.config.level.toString(),this.initEventListeners(),this.initGame()}initEventListeners(){window.addEventListener("keydown",e=>{this.state.keys.hasOwnProperty(e.key)&&(this.state.keys[e.key]=!0)}),window.addEventListener("keyup",e=>{this.state.keys.hasOwnProperty(e.key)&&(this.state.keys[e.key]=!1)}),this.nextLevelButton.addEventListener("click",()=>this.nextLevel()),this.restartButton.addEventListener("click",()=>this.restartGame()),this.timeoutRestartButton.addEventListener("click",()=>this.restartGame())}restartGame(){this.config.level=1,this.updateLevelConfig(),this.initLevel()}nextLevel(){this.config.level++,this.updateLevelConfig(),this.initLevel()}updateLevelConfig(){this.config.level<=4?(this.config.sheepCount=this.config.level,this.config.targetSheepCount=this.config.level,this.config.mapWidth=400,this.config.mapHeight=300):(this.config.sheepCount=this.config.level,this.config.targetSheepCount=this.config.level,this.config.mapWidth=600,this.config.mapHeight=450),this.canvas.width=this.config.mapWidth,this.canvas.height=this.config.mapHeight,this.state.gate.x=this.config.mapWidth-100,this.state.gate.y=this.config.mapHeight/2-this.config.gateHeight/2,this.state.wall.x=this.state.gate.x-5,this.state.wall.y=this.state.gate.y,this.state.wall.height=this.config.gateHeight}initLevel(){this.state.dog.x=this.config.mapWidth/2,this.state.dog.y=this.config.mapHeight/2,this.state.dog.direction="down",this.state.sheepInGate=0,this.state.levelComplete=!1,this.state.gameOver=!1,this.state.gameClear=!1,this.state.timeRemaining=this.config.timeLimit,this.sheepCountElement.textContent="0",this.targetCountElement.textContent=this.config.targetSheepCount.toString(),this.levelElement.textContent=this.config.level.toString(),this.timeElement.textContent=this.formatTime(this.state.timeRemaining),this.levelCompleteMessage.style.display="none",this.timeoutMessage.style.display="none",this.gameClearMessage.style.display="none",this.initializeSheep(),this.lastTime=performance.now(),this.timer&&cancelAnimationFrame(this.timer),this.gameLoop(this.lastTime)}initGame(){this.restartGame()}initializeSheep(){this.state.sheep=[];for(let e=0;e<this.config.sheepCount;e++){let i,t;do i=Math.random()*(this.canvas.width-100),t=Math.random()*this.canvas.height;while(i>this.state.gate.x-100&&t>this.state.gate.y-50&&t<this.state.gate.y+this.state.gate.height+50);this.state.sheep.push({x:i,y:t,vx:0,vy:0,width:60,height:60,inGate:!1,visible:!0,gateTimer:0,gateCooldown:0,stationaryTimer:0,lastX:i,lastY:t})}}updateDog(){const e=this.state.dog.x,i=this.state.dog.y;this.state.keys.ArrowUp&&(this.state.dog.y-=this.state.dog.speed,this.state.dog.direction="up"),this.state.keys.ArrowDown&&(this.state.dog.y+=this.state.dog.speed,this.state.dog.direction="down"),this.state.keys.ArrowLeft&&(this.state.dog.x-=this.state.dog.speed,this.state.dog.direction="left"),this.state.keys.ArrowRight&&(this.state.dog.x+=this.state.dog.speed,this.state.dog.direction="right"),this.state.dog.x=Math.max(0,Math.min(this.canvas.width-this.state.dog.width,this.state.dog.x)),this.state.dog.y=Math.max(0,Math.min(this.canvas.height-this.state.dog.height,this.state.dog.y)),this.checkCollision(this.state.dog,this.state.wall)&&(this.state.dog.x=e,this.state.dog.y=i)}checkCollision(e,i){return e.x<i.x+i.width&&e.x+e.width>i.x&&e.y<i.y+i.height&&e.y+e.height>i.y}updateSheep(e){this.state.sheepInGate=0,this.state.sheep.forEach(t=>{t.inGate&&this.state.sheepInGate++}),this.state.sheep.forEach(t=>{if(t.effect&&(t.effect.timer+=e/1e3,t.effect.timer>=t.effect.maxTime&&(t.effect=void 0)),!t.inGate){(t.lastX===void 0||t.lastY===void 0)&&(t.lastX=t.x,t.lastY=t.y,t.stationaryTimer=0);const h=t.x-t.lastX,v=t.y-t.lastY;if(Math.sqrt(h*h+v*v)<1){if(t.stationaryTimer===void 0&&(t.stationaryTimer=0),t.stationaryTimer+=e/1e3,t.stationaryTimer>3){const m=Math.random()*Math.PI*2;t.vx=Math.cos(m)*this.config.sheepSpeed,t.vy=Math.sin(m)*this.config.sheepSpeed,t.stationaryTimer=0}}else t.stationaryTimer=0;t.lastX=t.x,t.lastY=t.y}if(t.inGate&&t.gateTimer!==void 0)if(t.gateTimer+=e/1e3,t.gateTimer>=3){t.inGate=!1,t.gateTimer=0,t.gateCooldown=1,t.vx=0,Math.random()<.5?t.vy=-this.config.sheepSpeed*1.5:t.vy=this.config.sheepSpeed*1.5;return}else{t.vx+=(Math.random()-.5)*.1,t.vy+=(Math.random()-.5)*.1;const h=Math.sqrt(t.vx*t.vx+t.vy*t.vy);h>this.config.sheepSpeed*.5&&(t.vx=t.vx/h*this.config.sheepSpeed*.5,t.vy=t.vy/h*this.config.sheepSpeed*.5),t.x+=t.vx,t.y+=t.vy,t.x=Math.max(this.state.gate.x+3,Math.min(this.state.gate.x+this.state.gate.width-t.width-3,t.x)),t.y=Math.max(this.state.gate.y+2,Math.min(this.state.gate.y+this.state.gate.height-t.height-2,t.y));return}t.gateCooldown&&t.gateCooldown>0&&(t.gateCooldown-=e/1e3,t.gateCooldown<0&&(t.gateCooldown=0)),t.visible=!0,(!t.gateCooldown||t.gateCooldown<=0)&&t.x>this.state.gate.x&&t.x<this.state.gate.x+this.state.gate.width&&t.y>this.state.gate.y&&t.y<this.state.gate.y+this.state.gate.height?(t.inGate=!0,t.gateTimer=0):t.inGate||(t.inGate=!1);let s=0,o=0,r=0,f=0,u=0,x=0,y=0;const I=this.state.dog.x+this.state.dog.width/2-t.x-t.width/2,p=this.state.dog.y+this.state.dog.height/2-t.y-t.height/2,R=Math.sqrt(I*I+p*p);let S=0,F=0;if(R<this.config.dogInfluenceRadius){const h=1-R/this.config.dogInfluenceRadius;S=-I*h*.05,F=-p*h*.05}this.state.sheep.forEach(h=>{if(t===h)return;const v=h.x-t.x,L=h.y-t.y,m=Math.sqrt(v*v+L*L);m<30&&(s-=v/m,o-=L/m),m<70&&(r+=h.x,f+=h.y,u+=h.vx,x+=h.vy,y++)}),y>0&&(r=(r/y-t.x)*5e-4,f=(f/y-t.y)*5e-4,u=u/y*.1,x=x/y*.1),s*=.05,o*=.05;let g=0,l=0;const d=80,w=100,C=5,a=.2,B=t.x<w,G=t.x>this.canvas.width-w,k=t.y<w,T=t.y>this.canvas.height-w;B&&k?(g=C*a,l=C*a,g+=Math.random()*a,l+=Math.random()*a):G&&k?(g=-5*a,l=C*a,g-=Math.random()*a,l+=Math.random()*a):B&&T?(g=C*a,l=-5*a,g+=Math.random()*a,l-=Math.random()*a):G&&T?(g=-5*a,l=-5*a,g-=Math.random()*a,l-=Math.random()*a):(t.x<d?g=(d-t.x)*a:t.x>this.canvas.width-d&&(g=(this.canvas.width-d-t.x)*a),t.y<d?l=(d-t.y)*a:t.y>this.canvas.height-d&&(l=(this.canvas.height-d-t.y)*a)),t.vx+=r+u+s+S+g,t.vy+=f+x+o+F+l;const E=Math.sqrt(t.vx*t.vx+t.vy*t.vy);E>this.config.sheepSpeed&&(t.vx=t.vx/E*this.config.sheepSpeed,t.vy=t.vy/E*this.config.sheepSpeed);const b=t.x,D=t.y;t.x+=t.vx,t.y+=t.vy;const M=10;t.x=Math.max(M,Math.min(this.canvas.width-t.width-M,t.x)),t.y=Math.max(M,Math.min(this.canvas.height-t.height-M,t.y)),this.checkCollision(t,this.state.wall)&&(t.x=b,t.y=D,t.vx=-t.vx*.8+(Math.random()-.5)*.5,t.vy=t.vy*.8+(Math.random()-.5)*.5),t.visible=!0,(isNaN(t.x)||isNaN(t.y)||!isFinite(t.x)||!isFinite(t.y))&&(t.x=this.canvas.width/2,t.y=this.canvas.height/2,t.vx=0,t.vy=0,console.log("Rescued a sheep with invalid coordinates"))}),this.sheepCountElement.textContent=this.state.sheepInGate.toString(),this.state.sheep.every(t=>t.inGate)&&!this.state.levelComplete&&!this.state.gameOver&&(this.state.levelComplete=!0,this.config.level>=this.config.maxLevel?(this.state.gameClear=!0,this.gameClearMessage.style.display="block",this.showGameClearEffect()):this.levelCompleteMessage.style.display="block")}updateTime(e){!this.state.levelComplete&&!this.state.gameOver&&(this.state.timeRemaining-=e/1e3,this.timeElement.textContent=this.formatTime(this.state.timeRemaining),this.state.timeRemaining<=0&&(this.state.timeRemaining=0,this.state.gameOver=!0,this.timeoutMessage.style.display="block"))}showGameClearEffect(){const i=["#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF"];for(let t=0;t<100;t++)setTimeout(()=>{if(!this.ctx)return;const s=Math.random()*this.canvas.width,o=Math.random()*this.canvas.height,r=5+Math.random()*10,f=i[Math.floor(Math.random()*i.length)];this.ctx.fillStyle=f,this.ctx.beginPath(),this.ctx.arc(s,o,r,0,Math.PI*2),this.ctx.fill()},t*20)}formatTime(e){const i=Math.floor(Math.max(0,e)/60),t=Math.floor(Math.max(0,e)%60);return`${i}:${t<10?"0":""}${t}`}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#5D4037",this.ctx.fillRect(this.state.wall.x,this.state.wall.y,this.state.wall.width,this.state.wall.height),this.ctx.fillStyle="#8B4513",this.ctx.fillRect(this.state.gate.x,this.state.gate.y,this.state.gate.width,this.state.gate.height),this.ctx.fillStyle="#5D4037",this.ctx.fillRect(this.state.gate.x,this.state.gate.y,3,this.state.gate.height),this.ctx.fillRect(this.state.gate.x+this.state.gate.width-3,this.state.gate.y,3,this.state.gate.height),this.state.sheep.forEach(i=>{i.visible=!0;let t;Math.abs(i.vx)>Math.abs(i.vy)?i.vx>0?t=this.assets.sheepRight:t=this.assets.sheepLeft:i.vy>0?t=this.assets.sheepDown:t=this.assets.sheepUp,i.vx===0&&i.vy===0&&(t=this.assets.sheepDown),this.ctx.drawImage(t,i.x,i.y,i.width,i.height)});let e;switch(this.state.dog.direction){case"up":e=this.assets.dogUp;break;case"down":e=this.assets.dogDown;break;case"left":e=this.assets.dogLeft;break;case"right":e=this.assets.dogRight;break;default:e=this.assets.dogDown}this.ctx.drawImage(e,this.state.dog.x,this.state.dog.y,this.state.dog.width,this.state.dog.height)}gameLoop(e){const i=e-this.lastTime;this.lastTime=e,!this.state.levelComplete&&!this.state.gameOver&&(this.updateDog(),this.updateSheep(i),this.updateTime(i)),this.render(),this.timer=requestAnimationFrame(t=>this.gameLoop(t))}}document.addEventListener("DOMContentLoaded",()=>{new z("gameCanvas")});
